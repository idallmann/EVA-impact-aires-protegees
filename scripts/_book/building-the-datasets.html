<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Building the datasets | A Minimal Book Example</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Building the datasets | A Minimal Book Example" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Building the datasets | A Minimal Book Example" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="John Doe" />


<meta name="date" content="2023-07-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="building-the-datasets.html"><a href="building-the-datasets.html"><i class="fa fa-check"></i><b>2</b> Building the datasets</a>
<ul>
<li class="chapter" data-level="2.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#importing-relevant-packages"><i class="fa fa-check"></i><b>2.1</b> Importing relevant packages</a></li>
<li class="chapter" data-level="2.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-descriptive-statistics"><i class="fa fa-check"></i><b>2.2</b> Datasets for descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#cleaning-the-raw-dataset"><i class="fa fa-check"></i><b>2.2.1</b> Cleaning the raw dataset</a></li>
<li class="chapter" data-level="2.2.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-with-only-siop-variables"><i class="fa fa-check"></i><b>2.2.2</b> Dataset with only SIOP variables</a></li>
<li class="chapter" data-level="2.2.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-for-non-confidential-statistics"><i class="fa fa-check"></i><b>2.2.3</b> Dataset for non-confidential statistics</a></li>
<li class="chapter" data-level="2.2.4" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-for-confidential-descriptive-statistics"><i class="fa fa-check"></i><b>2.2.4</b> Dataset for confidential descriptive statistics</a></li>
<li class="chapter" data-level="2.2.5" data-path="building-the-datasets.html"><a href="building-the-datasets.html#a-polygon-dataset-without-confidential-information"><i class="fa fa-check"></i><b>2.2.5</b> A polygon dataset without confidential information</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample"><i class="fa fa-check"></i><b>2.3</b> Computing total areas covered by PAs in the sample</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computations-of-polygons-area"><i class="fa fa-check"></i><b>2.3.1</b> Computations of polygons’ area</a></li>
<li class="chapter" data-level="2.3.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level"><i class="fa fa-check"></i><b>2.3.2</b> Computing the intersection at country, region, world level</a></li>
<li class="chapter" data-level="2.3.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-without-intersection"><i class="fa fa-check"></i><b>2.3.3</b> Computing total areas without intersection</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="building-the-datasets.html"><a href="building-the-datasets.html#old-code"><i class="fa fa-check"></i><b>2.4</b> Old code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><i class="fa fa-check"></i><b>3</b> Descriptive statistics on biodiversity in the protected areas</a>
<ul>
<li class="chapter" data-level="3.1" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#importing-packages-and-functions"><i class="fa fa-check"></i><b>3.1</b> Importing packages and functions</a></li>
<li class="chapter" data-level="3.2" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#setting-the-environment"><i class="fa fa-check"></i><b>3.2</b> Setting the environment</a></li>
<li class="chapter" data-level="3.3" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#importing-pas-datasets"><i class="fa fa-check"></i><b>3.3</b> Importing PAs datasets</a></li>
<li class="chapter" data-level="3.4" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#downloading-data-of-interests-and-compute-relevant-indicators"><i class="fa fa-check"></i><b>3.4</b> Downloading data of interests and compute relevant indicators</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#creating-the-portfolio"><i class="fa fa-check"></i><b>3.4.1</b> Creating the portfolio</a></li>
<li class="chapter" data-level="3.4.2" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#test-importing-data-from-sspcloud"><i class="fa fa-check"></i><b>3.4.2</b> TEST : importing data from SSPCloud</a></li>
<li class="chapter" data-level="3.4.3" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#compute-indicators-from-geospatial-data"><i class="fa fa-check"></i><b>3.4.3</b> Compute indicators from geospatial data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#computing-statistics"><i class="fa fa-check"></i><b>3.5</b> Computing statistics</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#forests"><i class="fa fa-check"></i><b>3.5.1</b> Forests</a></li>
<li class="chapter" data-level="3.5.2" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#mangrove"><i class="fa fa-check"></i><b>3.5.2</b> Mangrove</a></li>
<li class="chapter" data-level="3.5.3" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#emissions"><i class="fa fa-check"></i><b>3.5.3</b> Emissions</a></li>
<li class="chapter" data-level="3.5.4" data-path="descriptive-statistics-on-biodiversity-in-the-protected-areas.html"><a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html#biometeow"><i class="fa fa-check"></i><b>3.5.4</b> Biome/TEOW</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html"><i class="fa fa-check"></i><b>4</b> Descriptive statistics on projects funded by the AFD</a>
<ul>
<li class="chapter" data-level="4.1" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#importing-packages"><i class="fa fa-check"></i><b>4.1</b> Importing packages</a></li>
<li class="chapter" data-level="4.2" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#importing-datasets"><i class="fa fa-check"></i><b>4.2</b> Importing datasets</a></li>
<li class="chapter" data-level="4.3" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#performing-descriptive-statistics"><i class="fa fa-check"></i><b>4.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#iucn-categories"><i class="fa fa-check"></i><b>4.3.1</b> IUCN categories</a></li>
<li class="chapter" data-level="4.3.2" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#ecosystems-excluding-non-referenced-pas"><i class="fa fa-check"></i><b>4.3.2</b> Ecosystems (excluding non-referenced PAs)</a></li>
<li class="chapter" data-level="4.3.3" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#distribution-of-pas-across-countries-and-regions"><i class="fa fa-check"></i><b>4.3.3</b> Distribution of PAs across countries and regions</a></li>
<li class="chapter" data-level="4.3.4" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#surface-of-pas"><i class="fa fa-check"></i><b>4.3.4</b> Surface of PAs</a></li>
<li class="chapter" data-level="4.3.5" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#temporal-evolution"><i class="fa fa-check"></i><b>4.3.5</b> Temporal evolution</a></li>
<li class="chapter" data-level="4.3.6" data-path="descriptive-statistics-on-projects-funded-by-the-afd.html"><a href="descriptive-statistics-on-projects-funded-by-the-afd.html#governance"><i class="fa fa-check"></i><b>4.3.6</b> Governance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hello-bookdown.html"><a href="hello-bookdown.html"><i class="fa fa-check"></i><b>5</b> Hello bookdown</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hello-bookdown.html"><a href="hello-bookdown.html#a-section"><i class="fa fa-check"></i><b>5.1</b> A section</a>
<ul>
<li class="chapter" data-level="" data-path="hello-bookdown.html"><a href="hello-bookdown.html#an-unnumbered-section"><i class="fa fa-check"></i>An unnumbered section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>6</b> Matching</a>
<ul>
<li class="chapter" data-level="6.1" data-path="matching.html"><a href="matching.html#initial-settings"><i class="fa fa-check"></i><b>6.1</b> Initial settings</a></li>
<li class="chapter" data-level="6.2" data-path="matching.html"><a href="matching.html#matching-process"><i class="fa fa-check"></i><b>6.2</b> Matching process</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="matching.html"><a href="matching.html#pre-processing"><i class="fa fa-check"></i><b>6.2.1</b> Pre-processing</a></li>
<li class="chapter" data-level="6.2.2" data-path="matching.html"><a href="matching.html#post-processing"><i class="fa fa-check"></i><b>6.2.2</b> Post-processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>7</b> Cross-references</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cross.html"><a href="cross.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>7.1</b> Chapters and sub-chapters</a></li>
<li class="chapter" data-level="7.2" data-path="cross.html"><a href="cross.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>7.2</b> Captioned figures and tables</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>8</b> Parts</a></li>
<li class="chapter" data-level="9" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>9</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="9.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>9.1</b> Footnotes</a></li>
<li class="chapter" data-level="9.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>9.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>10</b> Blocks</a>
<ul>
<li class="chapter" data-level="10.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>10.1</b> Equations</a></li>
<li class="chapter" data-level="10.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>10.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="10.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>10.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>11</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>11.1</b> Publishing</a></li>
<li class="chapter" data-level="11.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>11.2</b> 404 pages</a></li>
<li class="chapter" data-level="11.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>11.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Book Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-the-datasets" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Building the datasets<a href="building-the-datasets.html#building-the-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="importing-relevant-packages" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Importing relevant packages<a href="building-the-datasets.html#importing-relevant-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="building-the-datasets.html#cb3-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="building-the-datasets.html#cb3-2" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb3-3"><a href="building-the-datasets.html#cb3-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-4"><a href="building-the-datasets.html#cb3-4" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-5"><a href="building-the-datasets.html#cb3-5" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-6"><a href="building-the-datasets.html#cb3-6" tabindex="-1"></a><span class="fu">library</span>(splitstackshape) </span>
<span id="cb3-7"><a href="building-the-datasets.html#cb3-7" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb3-8"><a href="building-the-datasets.html#cb3-8" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb3-9"><a href="building-the-datasets.html#cb3-9" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-10"><a href="building-the-datasets.html#cb3-10" tabindex="-1"></a><span class="fu">library</span>(mapview)</span></code></pre></div>
</div>
<div id="datasets-for-descriptive-statistics" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Datasets for descriptive statistics<a href="building-the-datasets.html#datasets-for-descriptive-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The raw dataset has been built by Léa Poulin. It comes from the merging of SIOP extract, and PAs dataset from ARB covering 2000-2017 period. Majority of PAs had no corresponding WDPA ID, so it was found and reported manually by Léa Poulin and Ingrid Dallmann on WDPA website.</p>
<p>Different datasets are built. First a dataset (data_PA_tidy) enriched of information on co-investors and ISO code for the country hosting the PA.</p>
<p>From this dataset are extracted : (1) a dataset with only SIOP variables, to allow future working on PAs; (2) a dataset to perform most descriptive statistics, except confidential ones related to funding; (3) a confidential dataset with funding data.</p>
<p>Then a dataset of PAs polygons is imported from the WDPA, and confidential data removed.</p>
<p>Some statistics need size of PAs at country/region/world level (evolution of area covered by PAs at world level for instance). Datasets with total areas at country/region/world level are created. As many areas overlap (according to WDPA documentation), a sum of reported area would overestimate aggregated area. The computation method of WDPA is followed (<a href="https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage" class="uri">https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage</a>).</p>
<div id="cleaning-the-raw-dataset" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Cleaning the raw dataset<a href="building-the-datasets.html#cleaning-the-raw-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="building-the-datasets.html#cb4-1" tabindex="-1"></a><span class="co">#import a dataset with country names and corresponding ISO3 code</span></span>
<span id="cb4-2"><a href="building-the-datasets.html#cb4-2" tabindex="-1"></a>data_iso <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data_raw/liste-197-etats-2020.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="building-the-datasets.html#cb4-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;iso3&quot;</span> <span class="ot">=</span> <span class="st">&quot;CODE&quot;</span>,</span>
<span id="cb4-4"><a href="building-the-datasets.html#cb4-4" tabindex="-1"></a>         <span class="st">&quot;nom_alpha&quot;</span> <span class="ot">=</span> <span class="st">&quot;NOM_ALPHA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="building-the-datasets.html#cb4-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;nom_alpha&quot;</span>, <span class="st">&quot;iso3&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="building-the-datasets.html#cb4-6" tabindex="-1"></a>  <span class="co">#get rid of accentuations and change name by hand to correspond with BDD_joint</span></span>
<span id="cb4-7"><a href="building-the-datasets.html#cb4-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nom_alpha2 =</span> <span class="fu">iconv</span>(nom_alpha, <span class="at">to =</span> <span class="st">&quot;ASCII//TRANSLIT&quot;</span>),</span>
<span id="cb4-8"><a href="building-the-datasets.html#cb4-8" tabindex="-1"></a>         <span class="at">nom_alpha2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-9"><a href="building-the-datasets.html#cb4-9" tabindex="-1"></a>           nom_alpha2 <span class="sc">==</span> <span class="st">&quot;Cook (Iles)&quot;</span> <span class="sc">~</span> <span class="st">&quot;Cook&quot;</span>,</span>
<span id="cb4-10"><a href="building-the-datasets.html#cb4-10" tabindex="-1"></a>           nom_alpha2 <span class="sc">==</span> <span class="st">&quot;Cote d&#39;Ivoire&quot;</span> <span class="sc">~</span> <span class="st">&quot;Cote D Ivoire&quot;</span>,</span>
<span id="cb4-11"><a href="building-the-datasets.html#cb4-11" tabindex="-1"></a>           nom_alpha2 <span class="sc">==</span> <span class="st">&quot;Sao Tome-et-Principe&quot;</span> <span class="sc">~</span> <span class="st">&quot;Sao Tome&quot;</span>,</span>
<span id="cb4-12"><a href="building-the-datasets.html#cb4-12" tabindex="-1"></a>           nom_alpha2 <span class="sc">==</span> <span class="st">&quot;Palaos&quot;</span> <span class="sc">~</span> <span class="st">&quot;Palau&quot;</span>,</span>
<span id="cb4-13"><a href="building-the-datasets.html#cb4-13" tabindex="-1"></a>           nom_alpha2 <span class="sc">==</span> <span class="st">&quot;Guinee-Bissao&quot;</span> <span class="sc">~</span> <span class="st">&quot;Guinee-Bissau&quot;</span>,</span>
<span id="cb4-14"><a href="building-the-datasets.html#cb4-14" tabindex="-1"></a>           <span class="sc">!</span>(nom_alpha <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Cook (Iles)&quot;</span>, <span class="st">&quot;Cote d&#39;Ivoire&quot;</span>, <span class="st">&quot;Sao Tome-et-Principe&quot;</span>,</span>
<span id="cb4-15"><a href="building-the-datasets.html#cb4-15" tabindex="-1"></a>                              <span class="st">&quot;Palaos&quot;</span>, <span class="st">&quot;Guinée-Bissao&quot;</span>)) <span class="sc">~</span> nom_alpha2</span>
<span id="cb4-16"><a href="building-the-datasets.html#cb4-16" tabindex="-1"></a>         ))</span>
<span id="cb4-17"><a href="building-the-datasets.html#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a href="building-the-datasets.html#cb4-18" tabindex="-1"></a><span class="co">#Import the initial BDD_joint, change the encoding to keep accentuation </span></span>
<span id="cb4-19"><a href="building-the-datasets.html#cb4-19" tabindex="-1"></a>data_PA_raw <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">&quot;data_raw/BDD_joint.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="building-the-datasets.html#cb4-20" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="building-the-datasets.html#cb4-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">names</span>(.), </span>
<span id="cb4-22"><a href="building-the-datasets.html#cb4-22" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">stri_enc_toutf8</span>(.x)))</span>
<span id="cb4-23"><a href="building-the-datasets.html#cb4-23" tabindex="-1"></a></span>
<span id="cb4-24"><a href="building-the-datasets.html#cb4-24" tabindex="-1"></a><span class="co">#Modify errors in the dataset</span></span>
<span id="cb4-25"><a href="building-the-datasets.html#cb4-25" tabindex="-1"></a><span class="do">##WDPAID 797 in Senegal</span></span>
<span id="cb4-26"><a href="building-the-datasets.html#cb4-26" tabindex="-1"></a>data_PA_raw[data_PA_raw<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="st">&quot;797&quot;</span> <span class="sc">&amp;</span> data_PA_raw<span class="sc">$</span>pays <span class="sc">==</span> <span class="st">&quot;Senegal&quot;</span>,]<span class="sc">$</span>nom_ap <span class="ot">=</span> <span class="st">&quot;APAC de Kawawana&quot;</span></span>
<span id="cb4-27"><a href="building-the-datasets.html#cb4-27" tabindex="-1"></a>data_PA_raw[data_PA_raw<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="st">&quot;797&quot;</span> <span class="sc">&amp;</span> data_PA_raw<span class="sc">$</span>pays <span class="sc">==</span> <span class="st">&quot;Senegal&quot;</span>,]<span class="sc">$</span>wdpaid <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-28"><a href="building-the-datasets.html#cb4-28" tabindex="-1"></a><span class="do">##4223, 4224, 4226, 4228, 4229 : all in PS-N.Caledonie</span></span>
<span id="cb4-29"><a href="building-the-datasets.html#cb4-29" tabindex="-1"></a>data_PA_raw[data_PA_raw<span class="sc">$</span>wdpaid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;4223&quot;</span>, <span class="st">&quot;4224&quot;</span>, <span class="st">&quot;4226&quot;</span>, <span class="st">&quot;4228&quot;</span>, <span class="st">&quot;4229&quot;</span>) <span class="sc">&amp;</span> data_PA_raw<span class="sc">$</span>pays <span class="sc">==</span> <span class="st">&quot;Fidji&quot;</span>,]<span class="sc">$</span>pays <span class="ot">=</span> <span class="st">&quot;P-S N.Caléd&quot;</span></span>
<span id="cb4-30"><a href="building-the-datasets.html#cb4-30" tabindex="-1"></a><span class="do">##305082 : Vanuatu instead of Fidji</span></span>
<span id="cb4-31"><a href="building-the-datasets.html#cb4-31" tabindex="-1"></a>data_PA_raw[data_PA_raw<span class="sc">$</span>wdpaid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;305082&quot;</span>) <span class="sc">&amp;</span> data_PA_raw<span class="sc">$</span>pays <span class="sc">==</span> <span class="st">&quot;Fidji&quot;</span>,]<span class="sc">$</span>pays <span class="ot">=</span> <span class="st">&quot;Vanuatu&quot;</span></span>
<span id="cb4-32"><a href="building-the-datasets.html#cb4-32" tabindex="-1"></a></span>
<span id="cb4-33"><a href="building-the-datasets.html#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="building-the-datasets.html#cb4-34" tabindex="-1"></a><span class="co">#Create a clean dataset with relevant variables</span></span>
<span id="cb4-35"><a href="building-the-datasets.html#cb4-35" tabindex="-1"></a>data_PA_tidy <span class="ot">=</span> data_PA_raw <span class="sc">%&gt;%</span></span>
<span id="cb4-36"><a href="building-the-datasets.html#cb4-36" tabindex="-1"></a>  <span class="co">#Get rid of the iso code in the initial dataset, to avoid confusion when merging with data_iso</span></span>
<span id="cb4-37"><a href="building-the-datasets.html#cb4-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>iso3) <span class="sc">%&gt;%</span></span>
<span id="cb4-38"><a href="building-the-datasets.html#cb4-38" tabindex="-1"></a>  <span class="co">#Create dummy variables for main investors</span></span>
<span id="cb4-39"><a href="building-the-datasets.html#cb4-39" tabindex="-1"></a>  <span class="co">#AFD is always funder, so no need of a dummy</span></span>
<span id="cb4-40"><a href="building-the-datasets.html#cb4-40" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-41"><a href="building-the-datasets.html#cb4-41" tabindex="-1"></a>    <span class="co"># afd_bin = case_when((cofinancier_1 == &quot;AFD&quot; | cofinancier_2 == &quot;AFD&quot; | cofinancier_3 == &quot;AFD&quot; |</span></span>
<span id="cb4-42"><a href="building-the-datasets.html#cb4-42" tabindex="-1"></a>    <span class="co">#                       cofinancier_4 == &quot;AFD&quot; | cofinancier_5 == &quot;AFD&quot; | cofinancier_6 == &quot;AFD&quot;) ~ TRUE,</span></span>
<span id="cb4-43"><a href="building-the-datasets.html#cb4-43" tabindex="-1"></a>    <span class="co">#                       (is.na(cofinancier_1) &amp; is.na(cofinancier_2) &amp; is.na(cofinancier_3) &amp; is.na(cofinancier_4) </span></span>
<span id="cb4-44"><a href="building-the-datasets.html#cb4-44" tabindex="-1"></a>    <span class="co">#                       &amp; is.na(cofinancier_5) &amp; is.na(cofinancier_6)) ~ TRUE,</span></span>
<span id="cb4-45"><a href="building-the-datasets.html#cb4-45" tabindex="-1"></a>    <span class="co">#                       TRUE ~ FALSE),</span></span>
<span id="cb4-46"><a href="building-the-datasets.html#cb4-46" tabindex="-1"></a>         <span class="at">kfw_bin =</span> <span class="fu">ifelse</span>(cofinancier_1 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span> <span class="sc">|</span> cofinancier_2 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span> <span class="sc">|</span> cofinancier_3 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span> <span class="sc">|</span></span>
<span id="cb4-47"><a href="building-the-datasets.html#cb4-47" tabindex="-1"></a>                          cofinancier_4 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span> <span class="sc">|</span> cofinancier_5 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span> <span class="sc">|</span> cofinancier_6 <span class="sc">==</span> <span class="st">&quot;KFW&quot;</span>,</span>
<span id="cb4-48"><a href="building-the-datasets.html#cb4-48" tabindex="-1"></a>                          <span class="at">yes =</span> <span class="cn">TRUE</span>, </span>
<span id="cb4-49"><a href="building-the-datasets.html#cb4-49" tabindex="-1"></a>                          <span class="at">no =</span> <span class="cn">FALSE</span>),</span>
<span id="cb4-50"><a href="building-the-datasets.html#cb4-50" tabindex="-1"></a>         <span class="at">kfw_bin =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(kfw_bin), <span class="at">yes =</span> <span class="cn">FALSE</span>, <span class="at">no =</span> kfw_bin),</span>
<span id="cb4-51"><a href="building-the-datasets.html#cb4-51" tabindex="-1"></a>         <span class="at">ffem_bin =</span> <span class="fu">ifelse</span>(cofinancier_1 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span> <span class="sc">|</span> cofinancier_2 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span> <span class="sc">|</span> cofinancier_3 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span> <span class="sc">|</span></span>
<span id="cb4-52"><a href="building-the-datasets.html#cb4-52" tabindex="-1"></a>                          cofinancier_4 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span> <span class="sc">|</span> cofinancier_5 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span> <span class="sc">|</span> cofinancier_6 <span class="sc">==</span> <span class="st">&quot;FFEM&quot;</span>,</span>
<span id="cb4-53"><a href="building-the-datasets.html#cb4-53" tabindex="-1"></a>                          <span class="at">yes =</span> <span class="cn">TRUE</span>, </span>
<span id="cb4-54"><a href="building-the-datasets.html#cb4-54" tabindex="-1"></a>                          <span class="at">no =</span> <span class="cn">FALSE</span>),</span>
<span id="cb4-55"><a href="building-the-datasets.html#cb4-55" tabindex="-1"></a>         <span class="at">ffem_bin =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ffem_bin), <span class="at">yes =</span> <span class="cn">FALSE</span>, <span class="at">no =</span> ffem_bin),</span>
<span id="cb4-56"><a href="building-the-datasets.html#cb4-56" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;cofinancier_6&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-57"><a href="building-the-datasets.html#cb4-57" tabindex="-1"></a>  <span class="co">#Create a dummy for other co-investors</span></span>
<span id="cb4-58"><a href="building-the-datasets.html#cb4-58" tabindex="-1"></a>  <span class="co"># mutate(cofin_unkwn = ifelse(is.na(cofinancier_1) &amp; is.na(cofinancier_1) &amp; is.na(cofinancier_1) &amp; is.na(cofinancier_1) &amp; is.na(cofinancier_1) &amp; is.na(cofinancier_1),</span></span>
<span id="cb4-59"><a href="building-the-datasets.html#cb4-59" tabindex="-1"></a>  <span class="co">#                         yes = TRUE, </span></span>
<span id="cb4-60"><a href="building-the-datasets.html#cb4-60" tabindex="-1"></a>  <span class="co">#                         no = FALSE),</span></span>
<span id="cb4-61"><a href="building-the-datasets.html#cb4-61" tabindex="-1"></a>  <span class="co">#        cofin_unkwn = ifelse(is.na(cofin_unkwn), yes = FALSE, no = cofin_unkwn),</span></span>
<span id="cb4-62"><a href="building-the-datasets.html#cb4-62" tabindex="-1"></a>  <span class="co">#        .after = &quot;ffem_bin&quot;) %&gt;%</span></span>
<span id="cb4-63"><a href="building-the-datasets.html#cb4-63" tabindex="-1"></a>  <span class="co">#Create a dummy for investors not AFD, KFW or FFEM</span></span>
<span id="cb4-64"><a href="building-the-datasets.html#cb4-64" tabindex="-1"></a>  <span class="co"># mutate(cofin_other = afd_bin == FALSE &amp; </span></span>
<span id="cb4-65"><a href="building-the-datasets.html#cb4-65" tabindex="-1"></a>  <span class="co">#       kfw_bin == FALSE &amp; ffem_bin == FALSE &amp; cofin_unkwn == FALSE,</span></span>
<span id="cb4-66"><a href="building-the-datasets.html#cb4-66" tabindex="-1"></a>  <span class="co">#       .after = &quot;cofin_unkwn&quot;) %&gt;%</span></span>
<span id="cb4-67"><a href="building-the-datasets.html#cb4-67" tabindex="-1"></a>  <span class="co">#Add the ISO3 code corresponding to the country hosting the PA. Facilitate future mergings</span></span>
<span id="cb4-68"><a href="building-the-datasets.html#cb4-68" tabindex="-1"></a>  <span class="fu">left_join</span>(data_iso, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;pays&quot;</span> <span class="ot">=</span> <span class="st">&quot;nom_alpha2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-69"><a href="building-the-datasets.html#cb4-69" tabindex="-1"></a>  <span class="co">#Some entries in &quot;pays&quot; are French department, DROM-COM, &quot;Ocean Indien&quot; or &quot;Multi-Pays&quot;.</span></span>
<span id="cb4-70"><a href="building-the-datasets.html#cb4-70" tabindex="-1"></a>  <span class="co">#French related : assigned to France. Ocen Indien let NA value, Muti-pays set to ZZ as in the SIOP </span></span>
<span id="cb4-71"><a href="building-the-datasets.html#cb4-71" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-72"><a href="building-the-datasets.html#cb4-72" tabindex="-1"></a>    pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Mayotte&quot;</span>, <span class="st">&quot;P-N N.Caléd&quot;</span>, <span class="st">&quot;P-S N.Caléd&quot;</span>, </span>
<span id="cb4-73"><a href="building-the-datasets.html#cb4-73" tabindex="-1"></a>                <span class="st">&quot;Polynesie Francaise&quot;</span>, <span class="st">&quot;Nlle Caledonie&quot;</span>) <span class="sc">~</span> <span class="st">&quot;FRA&quot;</span>,</span>
<span id="cb4-74"><a href="building-the-datasets.html#cb4-74" tabindex="-1"></a>    pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Multi-Pays&quot;</span>, <span class="st">&quot;Ocean Indien&quot;</span>) <span class="sc">~</span> <span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb4-75"><a href="building-the-datasets.html#cb4-75" tabindex="-1"></a>    <span class="sc">!</span>(pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Mayotte&quot;</span>, <span class="st">&quot;P-N N.Caléd&quot;</span>, <span class="st">&quot;P-S N.Caléd&quot;</span>, </span>
<span id="cb4-76"><a href="building-the-datasets.html#cb4-76" tabindex="-1"></a>                <span class="st">&quot;Polynesie Francaise&quot;</span>, <span class="st">&quot;Nlle Caledonie&quot;</span>, <span class="st">&quot;Multi-Pays&quot;</span>)) <span class="sc">~</span> iso3</span>
<span id="cb4-77"><a href="building-the-datasets.html#cb4-77" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb4-78"><a href="building-the-datasets.html#cb4-78" tabindex="-1"></a>  <span class="co">#Add the description of IUCN from its category</span></span>
<span id="cb4-79"><a href="building-the-datasets.html#cb4-79" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iucn_des =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-80"><a href="building-the-datasets.html#cb4-80" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Réserve naturelle intégrale&quot;</span>,</span>
<span id="cb4-81"><a href="building-the-datasets.html#cb4-81" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Zone de nature sauvage&quot;</span>,</span>
<span id="cb4-82"><a href="building-the-datasets.html#cb4-82" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;Parc national&quot;</span>,</span>
<span id="cb4-83"><a href="building-the-datasets.html#cb4-83" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Monument naturel&quot;</span>,</span>
<span id="cb4-84"><a href="building-the-datasets.html#cb4-84" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. des habitats/espèces&quot;</span>,</span>
<span id="cb4-85"><a href="building-the-datasets.html#cb4-85" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Paysage protégé&quot;</span>,</span>
<span id="cb4-86"><a href="building-the-datasets.html#cb4-86" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. de ress. protégées&quot;</span>,</span>
<span id="cb4-87"><a href="building-the-datasets.html#cb4-87" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb4-88"><a href="building-the-datasets.html#cb4-88" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb4-89"><a href="building-the-datasets.html#cb4-89" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb4-90"><a href="building-the-datasets.html#cb4-90" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Non référencée&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb4-91"><a href="building-the-datasets.html#cb4-91" tabindex="-1"></a>    <span class="co">#Modify class of some variables</span></span>
<span id="cb4-92"><a href="building-the-datasets.html#cb4-92" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;superficie&quot;</span>,</span>
<span id="cb4-93"><a href="building-the-datasets.html#cb4-93" tabindex="-1"></a>                          <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb4-94"><a href="building-the-datasets.html#cb4-94" tabindex="-1"></a>                          <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span> ,</span>
<span id="cb4-95"><a href="building-the-datasets.html#cb4-95" tabindex="-1"></a>                          <span class="st">&quot;engagements_nets_euro_octroi&quot;</span>,</span>
<span id="cb4-96"><a href="building-the-datasets.html#cb4-96" tabindex="-1"></a>                          <span class="st">&quot;montant_total_projet&quot;</span>),</span>
<span id="cb4-97"><a href="building-the-datasets.html#cb4-97" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">as.numeric</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb4-98"><a href="building-the-datasets.html#cb4-98" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;superficie&quot;</span>,</span>
<span id="cb4-99"><a href="building-the-datasets.html#cb4-99" tabindex="-1"></a>                                  <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb4-100"><a href="building-the-datasets.html#cb4-100" tabindex="-1"></a>                          <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span> ,</span>
<span id="cb4-101"><a href="building-the-datasets.html#cb4-101" tabindex="-1"></a>                          <span class="st">&quot;engagements_nets_euro_octroi&quot;</span>,</span>
<span id="cb4-102"><a href="building-the-datasets.html#cb4-102" tabindex="-1"></a>                          <span class="st">&quot;montant_total_projet&quot;</span>), </span>
<span id="cb4-103"><a href="building-the-datasets.html#cb4-103" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">stri_enc_toutf8</span>(.x))) </span>
<span id="cb4-104"><a href="building-the-datasets.html#cb4-104" tabindex="-1"></a><span class="co">#fwrite(data_PA_tidy, &quot;data_tidy/BDD_joint_tidy.csv&quot;)</span></span></code></pre></div>
</div>
<div id="dataset-with-only-siop-variables" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Dataset with only SIOP variables<a href="building-the-datasets.html#dataset-with-only-siop-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="building-the-datasets.html#cb5-1" tabindex="-1"></a><span class="co">#Select info corresponding to SIOP extract and AP </span></span>
<span id="cb5-2"><a href="building-the-datasets.html#cb5-2" tabindex="-1"></a>list_var_siop_AP <span class="ot">=</span> <span class="fu">c</span>( <span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;nom_du_projet&quot;</span>, <span class="st">&quot;nom_de_projet_pour_les_instances&quot;</span>,</span>
<span id="cb5-3"><a href="building-the-datasets.html#cb5-3" tabindex="-1"></a>                      <span class="st">&quot;id_concours&quot;</span>, <span class="st">&quot;libelle_du_concours&quot;</span>, <span class="st">&quot;description_du_projet&quot;</span>,</span>
<span id="cb5-4"><a href="building-the-datasets.html#cb5-4" tabindex="-1"></a>                      <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;wdpaid_2&quot;</span>, <span class="st">&quot;wdpaid_3&quot;</span>,</span>
<span id="cb5-5"><a href="building-the-datasets.html#cb5-5" tabindex="-1"></a>                      <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>, <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>, </span>
<span id="cb5-6"><a href="building-the-datasets.html#cb5-6" tabindex="-1"></a>                      <span class="st">&quot;engagements_nets_euro_octroi&quot;</span>, <span class="st">&quot;montant_total_projet&quot;</span>, <span class="st">&quot;produit&quot;</span>, </span>
<span id="cb5-7"><a href="building-the-datasets.html#cb5-7" tabindex="-1"></a>                      <span class="st">&quot;libelle_produit&quot;</span>, <span class="st">&quot;division_technique&quot;</span>, <span class="st">&quot;libelle_division_technique&quot;</span>, <span class="st">&quot;agence&quot;</span>, </span>
<span id="cb5-8"><a href="building-the-datasets.html#cb5-8" tabindex="-1"></a>                      <span class="st">&quot;libelle_agence&quot;</span>, <span class="st">&quot;annee_octroi&quot;</span>, <span class="st">&quot;date_octroi&quot;</span>,</span>
<span id="cb5-9"><a href="building-the-datasets.html#cb5-9" tabindex="-1"></a>                      <span class="st">&quot;date_de_1er_versement_projet&quot;</span>, <span class="st">&quot;dernier_versement_en_date_projet&quot;</span>, </span>
<span id="cb5-10"><a href="building-the-datasets.html#cb5-10" tabindex="-1"></a>                      <span class="st">&quot;date_signature_convention_cf&quot;</span>, <span class="st">&quot;duree_du_concours_annee&quot;</span>,</span>
<span id="cb5-11"><a href="building-the-datasets.html#cb5-11" tabindex="-1"></a>                      <span class="st">&quot;duree_du_concours_annee_et_mois&quot;</span>, <span class="st">&quot;id_pays_de_realisation&quot;</span>, <span class="st">&quot;pays&quot;</span>, <span class="st">&quot;iso3&quot;</span>,</span>
<span id="cb5-12"><a href="building-the-datasets.html#cb5-12" tabindex="-1"></a>                      <span class="st">&quot;direction_regionale&quot;</span>, <span class="st">&quot;autres_pays_de_realisation&quot;</span>, </span>
<span id="cb5-13"><a href="building-the-datasets.html#cb5-13" tabindex="-1"></a>                      <span class="st">&quot;etat_du_projet&quot;</span>, <span class="st">&quot;libelle_etat_du_projet&quot;</span>, <span class="st">&quot;beneficiaire_primaire&quot;</span>,</span>
<span id="cb5-14"><a href="building-the-datasets.html#cb5-14" tabindex="-1"></a>                      <span class="st">&quot;responsable_equipe_projet&quot;</span>, <span class="st">&quot;directeur_trice_dagence&quot;</span>,</span>
<span id="cb5-15"><a href="building-the-datasets.html#cb5-15" tabindex="-1"></a>                      <span class="st">&quot;date_de_remise_du_rapport_final&quot;</span>, <span class="st">&quot;cofinancier_1&quot;</span>, <span class="st">&quot;cofinancier_2&quot;</span>, </span>
<span id="cb5-16"><a href="building-the-datasets.html#cb5-16" tabindex="-1"></a>                      <span class="st">&quot;cofinancier_3&quot;</span>,<span class="st">&quot;cofinancier_4&quot;</span>, <span class="st">&quot;cofinancier_5&quot;</span>, <span class="st">&quot;cofinancier_6&quot;</span>,</span>
<span id="cb5-17"><a href="building-the-datasets.html#cb5-17" tabindex="-1"></a>                      <span class="st">&quot;kfw_bin&quot;</span>, <span class="st">&quot;ffem_bin&quot;</span>,</span>
<span id="cb5-18"><a href="building-the-datasets.html#cb5-18" tabindex="-1"></a>                      <span class="st">&quot;maitrise_ouvrage&quot;</span>, <span class="st">&quot;superf_interne&quot;</span>, <span class="st">&quot;nb_ap_nombre_potentiel&quot;</span>, <span class="st">&quot;detail&quot;</span>, <span class="st">&quot;projet&quot;</span>, <span class="st">&quot;commentaires&quot;</span>)</span>
<span id="cb5-19"><a href="building-the-datasets.html#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="building-the-datasets.html#cb5-20" tabindex="-1"></a><span class="co">#Definining dataset for future analysis : siop and AP but not WDPA </span></span>
<span id="cb5-21"><a href="building-the-datasets.html#cb5-21" tabindex="-1"></a>data_siop_AP <span class="ot">=</span> data_PA_tidy <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="building-the-datasets.html#cb5-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(list_var_siop_AP), iso3)</span>
<span id="cb5-23"><a href="building-the-datasets.html#cb5-23" tabindex="-1"></a><span class="co">#write_csv(data_siop_AP, &quot;data_tidy/BDD_AP_SIOP_joint.xlsx&quot;)</span></span></code></pre></div>
</div>
<div id="dataset-for-non-confidential-statistics" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Dataset for non-confidential statistics<a href="building-the-datasets.html#dataset-for-non-confidential-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To perform descriptive statistics we want to keep one row per PA, characterized by WDPA ID or a name (if no ID reported). Some PAs can have several lines if they receive funds at different time or by different investors.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="building-the-datasets.html#cb6-1" tabindex="-1"></a><span class="co">#Listing relevant variables for descriptive statistics that are NOT confidential (i.e not concern funding)</span></span>
<span id="cb6-2"><a href="building-the-datasets.html#cb6-2" tabindex="-1"></a>list_var_PA_nofund <span class="ot">=</span> </span>
<span id="cb6-3"><a href="building-the-datasets.html#cb6-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;nom_du_projet&quot;</span>, <span class="st">&quot;nom_ap&quot;</span>, <span class="st">&quot;id_concours&quot;</span>, </span>
<span id="cb6-4"><a href="building-the-datasets.html#cb6-4" tabindex="-1"></a>    <span class="st">&quot;wdpaid&quot;</span>, </span>
<span id="cb6-5"><a href="building-the-datasets.html#cb6-5" tabindex="-1"></a>    <span class="st">&quot;pays&quot;</span>, <span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;direction_regionale&quot;</span>,</span>
<span id="cb6-6"><a href="building-the-datasets.html#cb6-6" tabindex="-1"></a>    <span class="st">&quot;annee_octroi&quot;</span>, <span class="st">&quot;nb_ap_nombre_potentiel&quot;</span>, <span class="st">&quot;detail&quot;</span>,</span>
<span id="cb6-7"><a href="building-the-datasets.html#cb6-7" tabindex="-1"></a>    <span class="st">&quot;iucn_cat&quot;</span>, <span class="st">&quot;iucn_des&quot;</span>, <span class="st">&quot;marine&quot;</span>, <span class="st">&quot;superficie&quot;</span>,</span>
<span id="cb6-8"><a href="building-the-datasets.html#cb6-8" tabindex="-1"></a>    <span class="st">&quot;status&quot;</span>, <span class="st">&quot;status_yr&quot;</span>, <span class="st">&quot;gov_type&quot;</span>,<span class="st">&quot;own_type&quot;</span>, <span class="st">&quot;mang_auth&quot;</span>)</span>
<span id="cb6-9"><a href="building-the-datasets.html#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="building-the-datasets.html#cb6-10" tabindex="-1"></a><span class="co">#Defining dataset for descriptive statistics</span></span>
<span id="cb6-11"><a href="building-the-datasets.html#cb6-11" tabindex="-1"></a>data_stat_nofund <span class="ot">=</span> data_PA_tidy <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="building-the-datasets.html#cb6-12" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(list_var_PA_nofund), iso3)</span>
<span id="cb6-13"><a href="building-the-datasets.html#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="building-the-datasets.html#cb6-14" tabindex="-1"></a><span class="co">#fwrite(data_stat_nofund, &quot;data_tidy/BDD_DesStat_nofund.csv&quot;)</span></span>
<span id="cb6-15"><a href="building-the-datasets.html#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="building-the-datasets.html#cb6-16" tabindex="-1"></a><span class="co">#Then to keep only one row per PA, we need to consider separately PAs having WDPA ID and PAs which do not.</span></span>
<span id="cb6-17"><a href="building-the-datasets.html#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="building-the-datasets.html#cb6-18" tabindex="-1"></a>data_stat_nofund_wdpa <span class="ot">=</span> data_stat_nofund <span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="building-the-datasets.html#cb6-19" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="building-the-datasets.html#cb6-20" tabindex="-1"></a>  <span class="fu">group_by</span>(wdpaid) <span class="sc">%&gt;%</span> </span>
<span id="cb6-21"><a href="building-the-datasets.html#cb6-21" tabindex="-1"></a>  <span class="fu">arrange</span>(annee_octroi) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="building-the-datasets.html#cb6-22" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="building-the-datasets.html#cb6-23" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-24"><a href="building-the-datasets.html#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="building-the-datasets.html#cb6-25" tabindex="-1"></a>data_stat_nofund_na <span class="ot">=</span> data_stat_nofund <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="building-the-datasets.html#cb6-26" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="building-the-datasets.html#cb6-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id1 =</span> <span class="fu">paste</span>(id_projet, iso3, nom_ap, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb6-28"><a href="building-the-datasets.html#cb6-28" tabindex="-1"></a>       <span class="at">.before =</span> id_projet) <span class="sc">%&gt;%</span></span>
<span id="cb6-29"><a href="building-the-datasets.html#cb6-29" tabindex="-1"></a>  <span class="fu">group_by</span>(id1) <span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="building-the-datasets.html#cb6-30" tabindex="-1"></a>  <span class="fu">arrange</span>(annee_octroi) <span class="sc">%&gt;%</span></span>
<span id="cb6-31"><a href="building-the-datasets.html#cb6-31" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="building-the-datasets.html#cb6-32" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="building-the-datasets.html#cb6-33" tabindex="-1"></a>  <span class="co">#remove id1 variable, to bind data_stat_na and data_stat_wdpa by row</span></span>
<span id="cb6-34"><a href="building-the-datasets.html#cb6-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id1)</span>
<span id="cb6-35"><a href="building-the-datasets.html#cb6-35" tabindex="-1"></a></span>
<span id="cb6-36"><a href="building-the-datasets.html#cb6-36" tabindex="-1"></a>data_stat_nofund_nodupl <span class="ot">=</span> <span class="fu">rbind</span>(data_stat_nofund_wdpa, data_stat_nofund_na) </span>
<span id="cb6-37"><a href="building-the-datasets.html#cb6-37" tabindex="-1"></a></span>
<span id="cb6-38"><a href="building-the-datasets.html#cb6-38" tabindex="-1"></a><span class="co">#fwrite(data_stat_nofund_nodupl, &quot;data_tidy/BDD_DesStat_nofund_nodupl.csv&quot;)</span></span></code></pre></div>
</div>
<div id="dataset-for-confidential-descriptive-statistics" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Dataset for confidential descriptive statistics<a href="building-the-datasets.html#dataset-for-confidential-descriptive-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="building-the-datasets.html#cb7-1" tabindex="-1"></a><span class="co">#Listing relevant variables for descriptive statistics</span></span>
<span id="cb7-2"><a href="building-the-datasets.html#cb7-2" tabindex="-1"></a>list_var_PA_fund <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;nom_du_projet&quot;</span>, <span class="st">&quot;nom_ap&quot;</span>, <span class="st">&quot;id_concours&quot;</span>, </span>
<span id="cb7-3"><a href="building-the-datasets.html#cb7-3" tabindex="-1"></a>                <span class="st">&quot;wdpaid&quot;</span>,</span>
<span id="cb7-4"><a href="building-the-datasets.html#cb7-4" tabindex="-1"></a>                <span class="st">&quot;pays&quot;</span>, <span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;direction_regionale&quot;</span>,</span>
<span id="cb7-5"><a href="building-the-datasets.html#cb7-5" tabindex="-1"></a>                <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb7-6"><a href="building-the-datasets.html#cb7-6" tabindex="-1"></a>                <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb7-7"><a href="building-the-datasets.html#cb7-7" tabindex="-1"></a>                <span class="st">&quot;engagements_nets_euro_octroi&quot;</span>,</span>
<span id="cb7-8"><a href="building-the-datasets.html#cb7-8" tabindex="-1"></a>                <span class="st">&quot;montant_total_projet&quot;</span>, <span class="st">&quot;libelle_produit&quot;</span>, <span class="st">&quot;annee_octroi&quot;</span>,</span>
<span id="cb7-9"><a href="building-the-datasets.html#cb7-9" tabindex="-1"></a>                <span class="st">&quot;cofinancier_1&quot;</span>, <span class="st">&quot;cofinancier_2&quot;</span>, <span class="st">&quot;cofinancier_3&quot;</span>, </span>
<span id="cb7-10"><a href="building-the-datasets.html#cb7-10" tabindex="-1"></a>                <span class="st">&quot;cofinancier_4&quot;</span>, <span class="st">&quot;cofinancier_5&quot;</span>, <span class="st">&quot;cofinancier_6&quot;</span>,</span>
<span id="cb7-11"><a href="building-the-datasets.html#cb7-11" tabindex="-1"></a>                 <span class="st">&quot;kfw_bin&quot;</span>, <span class="st">&quot;ffem_bin&quot;</span>)</span>
<span id="cb7-12"><a href="building-the-datasets.html#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="building-the-datasets.html#cb7-13" tabindex="-1"></a><span class="co">#Defining dataset for descriptive statistics</span></span>
<span id="cb7-14"><a href="building-the-datasets.html#cb7-14" tabindex="-1"></a><span class="co">#Duplicates are not revmoved here, as we want the information on the different concours for instance. Peculiar datasets </span></span>
<span id="cb7-15"><a href="building-the-datasets.html#cb7-15" tabindex="-1"></a>data_stat_fund <span class="ot">=</span> data_PA_tidy <span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="building-the-datasets.html#cb7-16" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(list_var_PA_fund), iso3)</span>
<span id="cb7-17"><a href="building-the-datasets.html#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="building-the-datasets.html#cb7-18" tabindex="-1"></a><span class="co">#fwrite(data_stat_fund, &quot;data_tidy/BDD_DesStat_fund.csv&quot;)</span></span></code></pre></div>
</div>
<div id="a-polygon-dataset-without-confidential-information" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> A polygon dataset without confidential information<a href="building-the-datasets.html#a-polygon-dataset-without-confidential-information" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="building-the-datasets.html#cb8-1" tabindex="-1"></a><span class="co">#The confidential information removed concern funding or nominative variables</span></span>
<span id="cb8-2"><a href="building-the-datasets.html#cb8-2" tabindex="-1"></a>pa_shp <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">&quot;data_raw/WDPA_SHP/BDD_SHP_nodupl.shp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="building-the-datasets.html#cb8-3" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="building-the-datasets.html#cb8-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(mntnt, mtglb, e, mnt, prodt, lbllp, dt_ct, d_1, d, d_c, durdcncrs_a, drdcncrs_an, atrsp, ett, lbllt, rspns, dr, mtrs, detal, projt, cmmnt, cmmnt_1))</span>
<span id="cb8-5"><a href="building-the-datasets.html#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="building-the-datasets.html#cb8-6" tabindex="-1"></a><span class="co"># st_write(pa_shp,</span></span>
<span id="cb8-7"><a href="building-the-datasets.html#cb8-7" tabindex="-1"></a><span class="co">#          dsn = &quot;data_tidy/BDD_shp_pub.gpkg&quot;,</span></span>
<span id="cb8-8"><a href="building-the-datasets.html#cb8-8" tabindex="-1"></a><span class="co">#          delete_dsn = TRUE)</span></span>
<span id="cb8-9"><a href="building-the-datasets.html#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="building-the-datasets.html#cb8-10" tabindex="-1"></a><span class="fu">rm</span>(pa_shp)</span></code></pre></div>
</div>
</div>
<div id="computing-total-areas-covered-by-pas-in-the-sample" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Computing total areas covered by PAs in the sample<a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Knowing the total area covered by PAs at different level of aggregation is interesting per se. It is also necessary to compute several statistics (e.g average funding by unit of area). According to the WDPA documentation, it is likely that some reported polygons overlap. Simply summing the areas would thus lead to a biased estimate of the total area at a given level of aggregation. We follow the procedure of the WDPA (<a href="https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage" class="uri">https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage</a>). Our case is simpler as all of the PAs we consider are given a polygon.</p>
<ol style="list-style-type: decimal">
<li><p>The layer is converted to Mollweide (an equal area projection) and the area of each polygon is calculated, in km2.</p></li>
<li><p>Intersection of polygons and the corresponding area are computed.</p></li>
<li><p>Then the intersection can be aggregated at country, region or world level. Then it is subtracted to the sum of areas at country, region or world level. Note that intersections between PAs whose polygon is unknown won’t be taken into account.</p></li>
</ol>
<p>Note that the following codes are about computing total area at country/region/world level, taking potential intersections into account. It is not about generating a new shape files for the impact analysis. Indeed the overlap should be taken into account in the impact evaluation analysis codes.</p>
<div id="computations-of-polygons-area" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Computations of polygons’ area<a href="building-the-datasets.html#computations-of-polygons-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="building-the-datasets.html#cb9-1" tabindex="-1"></a><span class="co">#Importing shapefiles</span></span>
<span id="cb9-2"><a href="building-the-datasets.html#cb9-2" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb9-3"><a href="building-the-datasets.html#cb9-3" tabindex="-1"></a>pa_shp <span class="ot">=</span> </span>
<span id="cb9-4"><a href="building-the-datasets.html#cb9-4" tabindex="-1"></a>  <span class="fu">read_sf</span>(<span class="st">&quot;data_tidy/BDD_shp_raw.gpkg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="building-the-datasets.html#cb9-5" tabindex="-1"></a>  <span class="co"># aws.s3::s3read_using(</span></span>
<span id="cb9-6"><a href="building-the-datasets.html#cb9-6" tabindex="-1"></a>  <span class="co"># FUN = sf::read_sf,</span></span>
<span id="cb9-7"><a href="building-the-datasets.html#cb9-7" tabindex="-1"></a>  <span class="co"># # Mettre les options de FUN ici</span></span>
<span id="cb9-8"><a href="building-the-datasets.html#cb9-8" tabindex="-1"></a>  <span class="co"># object = &quot;data_tidy/BDD_SHP_nodupl_pub.gpkg&quot;,</span></span>
<span id="cb9-9"><a href="building-the-datasets.html#cb9-9" tabindex="-1"></a>  <span class="co"># bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb9-10"><a href="building-the-datasets.html#cb9-10" tabindex="-1"></a>  <span class="co"># opts = list(&quot;region&quot; = &quot;&quot;)) %&gt;%</span></span>
<span id="cb9-11"><a href="building-the-datasets.html#cb9-11" tabindex="-1"></a>  <span class="co">#Ensure all geometries are valid</span></span>
<span id="cb9-12"><a href="building-the-datasets.html#cb9-12" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-13"><a href="building-the-datasets.html#cb9-13" tabindex="-1"></a>  <span class="co">#From multipolygon to polygon</span></span>
<span id="cb9-14"><a href="building-the-datasets.html#cb9-14" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="at">to=</span><span class="st">&quot;POLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="building-the-datasets.html#cb9-15" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="building-the-datasets.html#cb9-16" tabindex="-1"></a>  <span class="co">#Select relevant variables</span></span>
<span id="cb9-17"><a href="building-the-datasets.html#cb9-17" tabindex="-1"></a>  <span class="co">#Note ann_c = annee_octroi in the initial database data_PA_raw</span></span>
<span id="cb9-18"><a href="building-the-datasets.html#cb9-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(wdpaid, sprfc, rep_a, gis_a, geom, iso3, drct, ann_c)) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="building-the-datasets.html#cb9-19" tabindex="-1"></a>  <span class="co">#Variable sprfc corresponds to AFD internal reported size</span></span>
<span id="cb9-20"><a href="building-the-datasets.html#cb9-20" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;sprfc_int&quot;</span> <span class="ot">=</span> <span class="st">&quot;sprfc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="building-the-datasets.html#cb9-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wdpaid =</span> <span class="fu">as.numeric</span>(wdpaid),</span>
<span id="cb9-22"><a href="building-the-datasets.html#cb9-22" tabindex="-1"></a>         <span class="at">sprfc_int =</span> <span class="fu">as.numeric</span>(sprfc_int)) </span>
<span id="cb9-23"><a href="building-the-datasets.html#cb9-23" tabindex="-1"></a></span>
<span id="cb9-24"><a href="building-the-datasets.html#cb9-24" tabindex="-1"></a><span class="co">#Spatial definition of wdpaid 555547988 overlaps CMR and CAF. Wdpaid 1245 corresponds to the CMR part. The overlap is removed and iso3 redefined so that 555547988 is CAF only. </span></span>
<span id="cb9-25"><a href="building-the-datasets.html#cb9-25" tabindex="-1"></a>geom_555547988_1245 <span class="ot">=</span> <span class="fu">st_difference</span>(pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>geom, pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">1245</span>,]<span class="sc">$</span>geom)</span>
<span id="cb9-26"><a href="building-the-datasets.html#cb9-26" tabindex="-1"></a>pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>geom <span class="ot">=</span> geom_555547988_1245</span>
<span id="cb9-27"><a href="building-the-datasets.html#cb9-27" tabindex="-1"></a>pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>iso3 <span class="ot">=</span> <span class="st">&quot;CAF&quot;</span></span>
<span id="cb9-28"><a href="building-the-datasets.html#cb9-28" tabindex="-1"></a></span>
<span id="cb9-29"><a href="building-the-datasets.html#cb9-29" tabindex="-1"></a><span class="co">#Define a tidy version of the former dataset, with modifications on wdpaid 555547988</span></span>
<span id="cb9-30"><a href="building-the-datasets.html#cb9-30" tabindex="-1"></a>pa_shp_tidy <span class="ot">=</span> pa_shp <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="building-the-datasets.html#cb9-31" tabindex="-1"></a>  <span class="co">#Project to Mollweide to compute relevant areas in km2</span></span>
<span id="cb9-32"><a href="building-the-datasets.html#cb9-32" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">&quot;+proj=moll +datum=WGS84&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="building-the-datasets.html#cb9-33" tabindex="-1"></a>  <span class="co">#Compute areas in km2 from the geometry, in km2. It must be equal to gis_a by definition </span></span>
<span id="cb9-34"><a href="building-the-datasets.html#cb9-34" tabindex="-1"></a>  <span class="co">#Then to take into account potential refinements of the geometries (as for wdpaid 55547988), a variable for relevant area is defined. It takes rep_a value except for modified geometries where area_sf_moll is taken</span></span>
<span id="cb9-35"><a href="building-the-datasets.html#cb9-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sf_moll =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom)<span class="sc">/</span><span class="fl">1e6</span>),</span>
<span id="cb9-36"><a href="building-the-datasets.html#cb9-36" tabindex="-1"></a>         <span class="at">sprfc_km2 =</span> <span class="fu">ifelse</span>(wdpaid <span class="sc">==</span> <span class="dv">555547988</span>, <span class="at">yes =</span> area_sf_moll, <span class="at">no =</span> rep_a))</span></code></pre></div>
</div>
<div id="computing-the-intersection-at-country-region-world-level" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Computing the intersection at country, region, world level<a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="building-the-datasets.html#cb10-1" tabindex="-1"></a><span class="co">#Compute intersecting areas of polygons</span></span>
<span id="cb10-2"><a href="building-the-datasets.html#cb10-2" tabindex="-1"></a>pa_int <span class="ot">=</span> <span class="fu">st_intersection</span>(pa_shp_tidy, pa_shp_tidy) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="building-the-datasets.html#cb10-3" tabindex="-1"></a>  <span class="co">#Remove intersection of polygons with themselves</span></span>
<span id="cb10-4"><a href="building-the-datasets.html#cb10-4" tabindex="-1"></a>  <span class="fu">subset</span>(wdpaid <span class="sc">!=</span> wdpaid<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="building-the-datasets.html#cb10-5" tabindex="-1"></a>  <span class="co">#If one of the two intersectin polygon have unknwon area, then it is not necessary to subtract the interesction area. Indeed there is no double-counting of the intersection in this case, when both polygon areas are summed.</span></span>
<span id="cb10-6"><a href="building-the-datasets.html#cb10-6" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(sprfc_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(sprfc_km2<span class="fl">.1</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="building-the-datasets.html#cb10-7" tabindex="-1"></a>  <span class="co">#Compute the intersecting areas (pa_shp already in Mollweide projection) in km2</span></span>
<span id="cb10-8"><a href="building-the-datasets.html#cb10-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_int =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom)<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="building-the-datasets.html#cb10-9" tabindex="-1"></a>  <span class="co">#Now duplicates need to be removed : intersection of X with Y AND intersection of Y with X are reported. We need only one.</span></span>
<span id="cb10-10"><a href="building-the-datasets.html#cb10-10" tabindex="-1"></a>  <span class="co">#An id_int to identify the intersection of a given pair</span></span>
<span id="cb10-11"><a href="building-the-datasets.html#cb10-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int =</span> <span class="fu">paste0</span>(wdpaid, <span class="st">&quot;_&quot;</span>, wdpaid<span class="fl">.1</span>), <span class="at">.before =</span> wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="building-the-datasets.html#cb10-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int_temp =</span> <span class="fu">paste0</span>(wdpaid, <span class="st">&quot;_&quot;</span>, wdpaid<span class="fl">.1</span>), <span class="at">.before =</span> wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="building-the-datasets.html#cb10-13" tabindex="-1"></a>  <span class="co">#create a mirror idX_idY --&gt; idY_idX so that we identify the both member of a pair with the same id</span></span>
<span id="cb10-14"><a href="building-the-datasets.html#cb10-14" tabindex="-1"></a>  <span class="fu">separate</span>(id_int_temp, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;id_temp1&quot;</span>, <span class="st">&quot;id_temp2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="building-the-datasets.html#cb10-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int_rev =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-16"><a href="building-the-datasets.html#cb10-16" tabindex="-1"></a>    id_temp1 <span class="sc">&lt;</span> id_temp2 <span class="sc">~</span> <span class="fu">paste</span>(id_temp1, id_temp2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb10-17"><a href="building-the-datasets.html#cb10-17" tabindex="-1"></a>    id_temp1 <span class="sc">&gt;</span> id_temp2 <span class="sc">~</span> <span class="fu">paste</span>(id_temp2, id_temp1, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb10-18"><a href="building-the-datasets.html#cb10-18" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste</span>(id_temp1, id_temp2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)),</span>
<span id="cb10-19"><a href="building-the-datasets.html#cb10-19" tabindex="-1"></a>    <span class="at">.after =</span> id_int) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="building-the-datasets.html#cb10-20" tabindex="-1"></a>  <span class="co">#finally, get rid of the duplicates (have the same id_int_rev)</span></span>
<span id="cb10-21"><a href="building-the-datasets.html#cb10-21" tabindex="-1"></a>  <span class="fu">group_by</span>(id_int_rev) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="building-the-datasets.html#cb10-22" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="building-the-datasets.html#cb10-23" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="building-the-datasets.html#cb10-24" tabindex="-1"></a>  <span class="co">#select relevant variables only</span></span>
<span id="cb10-25"><a href="building-the-datasets.html#cb10-25" tabindex="-1"></a>  <span class="fu">select</span>(wdpaid, iso3, drct, ann_c, wdpaid<span class="fl">.1</span>, iso3<span class="fl">.1</span>, drct<span class="fl">.1</span>, ann_c<span class="fl">.1</span>, geom, area_int)</span>
<span id="cb10-26"><a href="building-the-datasets.html#cb10-26" tabindex="-1"></a></span>
<span id="cb10-27"><a href="building-the-datasets.html#cb10-27" tabindex="-1"></a><span class="co">#Computing the total area of intersections</span></span>
<span id="cb10-28"><a href="building-the-datasets.html#cb10-28" tabindex="-1"></a><span class="co">#At country level ...</span></span>
<span id="cb10-29"><a href="building-the-datasets.html#cb10-29" tabindex="-1"></a>pa_int_ctry <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb10-30"><a href="building-the-datasets.html#cb10-30" tabindex="-1"></a>  <span class="co">#Only overlapping PAs in the same country are considered</span></span>
<span id="cb10-31"><a href="building-the-datasets.html#cb10-31" tabindex="-1"></a>  <span class="fu">subset</span>(iso3 <span class="sc">==</span>  iso3<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="building-the-datasets.html#cb10-32" tabindex="-1"></a>  <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="building-the-datasets.html#cb10-33" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_area_int =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb10-34"><a href="building-the-datasets.html#cb10-34" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb10-35"><a href="building-the-datasets.html#cb10-35" tabindex="-1"></a></span>
<span id="cb10-36"><a href="building-the-datasets.html#cb10-36" tabindex="-1"></a><span class="co">#At region level</span></span>
<span id="cb10-37"><a href="building-the-datasets.html#cb10-37" tabindex="-1"></a>pa_int_dr <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb10-38"><a href="building-the-datasets.html#cb10-38" tabindex="-1"></a>  <span class="co">#Only overlapping PAs in the same DR are considered</span></span>
<span id="cb10-39"><a href="building-the-datasets.html#cb10-39" tabindex="-1"></a>  <span class="fu">subset</span>(drct <span class="sc">==</span> drct<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-40"><a href="building-the-datasets.html#cb10-40" tabindex="-1"></a>  <span class="fu">group_by</span>(drct) <span class="sc">%&gt;%</span></span>
<span id="cb10-41"><a href="building-the-datasets.html#cb10-41" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_area_int =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb10-42"><a href="building-the-datasets.html#cb10-42" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb10-43"><a href="building-the-datasets.html#cb10-43" tabindex="-1"></a></span>
<span id="cb10-44"><a href="building-the-datasets.html#cb10-44" tabindex="-1"></a><span class="do">##At world level : all overlap are considered</span></span>
<span id="cb10-45"><a href="building-the-datasets.html#cb10-45" tabindex="-1"></a>pa_int_wld <span class="ot">=</span> <span class="fu">sum</span>(pa_int<span class="sc">$</span>area_int) </span>
<span id="cb10-46"><a href="building-the-datasets.html#cb10-46" tabindex="-1"></a></span>
<span id="cb10-47"><a href="building-the-datasets.html#cb10-47" tabindex="-1"></a><span class="co">#Compute the total intersection for each year</span></span>
<span id="cb10-48"><a href="building-the-datasets.html#cb10-48" tabindex="-1"></a>pa_int_yr <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb10-49"><a href="building-the-datasets.html#cb10-49" tabindex="-1"></a>  <span class="co">#Define intersection year : the date ann_c of the later PA in the pair</span></span>
<span id="cb10-50"><a href="building-the-datasets.html#cb10-50" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-51"><a href="building-the-datasets.html#cb10-51" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annee_int =</span> <span class="fu">max</span>(ann_c, ann_c<span class="fl">.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-52"><a href="building-the-datasets.html#cb10-52" tabindex="-1"></a>  <span class="fu">group_by</span>(annee_int) <span class="sc">%&gt;%</span></span>
<span id="cb10-53"><a href="building-the-datasets.html#cb10-53" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_int_km2 =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb10-54"><a href="building-the-datasets.html#cb10-54" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb10-55"><a href="building-the-datasets.html#cb10-55" tabindex="-1"></a></span>
<span id="cb10-56"><a href="building-the-datasets.html#cb10-56" tabindex="-1"></a><span class="co"># fwrite(pa_int_yr,</span></span>
<span id="cb10-57"><a href="building-the-datasets.html#cb10-57" tabindex="-1"></a><span class="co">#        &quot;data_tidy/area/pa_int_yr.csv&quot;)</span></span></code></pre></div>
</div>
<div id="computing-total-areas-without-intersection" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Computing total areas without intersection<a href="building-the-datasets.html#computing-total-areas-without-intersection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="building-the-datasets.html#cb11-1" tabindex="-1"></a><span class="co">#At country level ...</span></span>
<span id="cb11-2"><a href="building-the-datasets.html#cb11-2" tabindex="-1"></a>pa_area_ctry <span class="ot">=</span> data_stat_nofund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="building-the-datasets.html#cb11-3" tabindex="-1"></a>  <span class="co">#Compute total area at country level</span></span>
<span id="cb11-4"><a href="building-the-datasets.html#cb11-4" tabindex="-1"></a>  <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="building-the-datasets.html#cb11-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sprfc_tot_km2 =</span> <span class="fu">sum</span>(superficie)) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="building-the-datasets.html#cb11-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="building-the-datasets.html#cb11-7" tabindex="-1"></a>  <span class="co">#Add information on intersection area in each country. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb11-8"><a href="building-the-datasets.html#cb11-8" tabindex="-1"></a>  <span class="fu">left_join</span>(pa_int_ctry, <span class="at">by =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="building-the-datasets.html#cb11-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_area_int =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(tot_area_int) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="cn">TRUE</span> <span class="sc">~</span> tot_area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="building-the-datasets.html#cb11-10" tabindex="-1"></a>  <span class="co">#Compute the total area at country level without intersection</span></span>
<span id="cb11-11"><a href="building-the-datasets.html#cb11-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sprfc_tot_noint_km2 =</span> sprfc_tot_km2 <span class="sc">-</span> tot_area_int) </span>
<span id="cb11-12"><a href="building-the-datasets.html#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="building-the-datasets.html#cb11-13" tabindex="-1"></a><span class="co">#fwrite(pa_area_ctry, &quot;data_tidy/area/pa_area_ctry.csv&quot;)</span></span>
<span id="cb11-14"><a href="building-the-datasets.html#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="building-the-datasets.html#cb11-15" tabindex="-1"></a><span class="co">#At DR level ...</span></span>
<span id="cb11-16"><a href="building-the-datasets.html#cb11-16" tabindex="-1"></a>pa_area_dr <span class="ot">=</span> data_stat_nofund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="building-the-datasets.html#cb11-17" tabindex="-1"></a>  <span class="co">#Compute total area at dr level</span></span>
<span id="cb11-18"><a href="building-the-datasets.html#cb11-18" tabindex="-1"></a>  <span class="fu">group_by</span>(direction_regionale) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="building-the-datasets.html#cb11-19" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sprfc_tot_km2 =</span> <span class="fu">sum</span>(superficie)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="building-the-datasets.html#cb11-20" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="building-the-datasets.html#cb11-21" tabindex="-1"></a>  <span class="co">#Add information on intersection area in each DR. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb11-22"><a href="building-the-datasets.html#cb11-22" tabindex="-1"></a>  <span class="fu">left_join</span>(pa_int_dr, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;direction_regionale&quot;</span> <span class="ot">=</span> <span class="st">&quot;drct&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="building-the-datasets.html#cb11-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_area_int =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(tot_area_int) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span><span class="dv">0</span>, <span class="cn">TRUE</span> <span class="sc">~</span>tot_area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="building-the-datasets.html#cb11-24" tabindex="-1"></a>  <span class="co">#Compute the total area at country level without intersection</span></span>
<span id="cb11-25"><a href="building-the-datasets.html#cb11-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sprfc_tot_noint_km2 =</span> sprfc_tot_km2 <span class="sc">-</span> tot_area_int) <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="building-the-datasets.html#cb11-26" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb11-27"><a href="building-the-datasets.html#cb11-27" tabindex="-1"></a></span>
<span id="cb11-28"><a href="building-the-datasets.html#cb11-28" tabindex="-1"></a><span class="co">#fwrite(pa_area_dr, &quot;data_tidy/area/pa_area_dr.csv&quot;)</span></span>
<span id="cb11-29"><a href="building-the-datasets.html#cb11-29" tabindex="-1"></a></span>
<span id="cb11-30"><a href="building-the-datasets.html#cb11-30" tabindex="-1"></a><span class="co">#At world level</span></span>
<span id="cb11-31"><a href="building-the-datasets.html#cb11-31" tabindex="-1"></a>pa_area_wld <span class="ot">=</span> <span class="fu">sum</span>(data_stat_nofund_nodupl<span class="sc">$</span>superficie) <span class="sc">-</span> pa_int_wld <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="building-the-datasets.html#cb11-32" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="building-the-datasets.html#cb11-33" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;sprfc_tot_noint_km2&quot;</span> <span class="ot">=</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb11-34"><a href="building-the-datasets.html#cb11-34" tabindex="-1"></a><span class="co">#fwrite(pa_area_wld, &quot;data_tidy/area/pa_area_wld.csv&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="old-code" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Old code<a href="building-the-datasets.html#old-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="building-the-datasets.html#cb12-1" tabindex="-1"></a><span class="co">#Listing variables public or confidential</span></span>
<span id="cb12-2"><a href="building-the-datasets.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="building-the-datasets.html#cb12-3" tabindex="-1"></a><span class="co">#Public variables in the PAs dataset</span></span>
<span id="cb12-4"><a href="building-the-datasets.html#cb12-4" tabindex="-1"></a>list_var_PA_open <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;nom_du_projet&quot;</span>, <span class="st">&quot;nom_ap&quot;</span>, <span class="st">&quot;id_concours&quot;</span>, </span>
<span id="cb12-5"><a href="building-the-datasets.html#cb12-5" tabindex="-1"></a>                <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;wdpaid_2&quot;</span>, <span class="st">&quot;wdpaid_3&quot;</span>, <span class="st">&quot;wdpa_pid&quot;</span>,</span>
<span id="cb12-6"><a href="building-the-datasets.html#cb12-6" tabindex="-1"></a>                <span class="st">&quot;pays&quot;</span>, <span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;direction_regionale&quot;</span>, <span class="st">&quot;annee_octroi&quot;</span>,</span>
<span id="cb12-7"><a href="building-the-datasets.html#cb12-7" tabindex="-1"></a>                <span class="st">&quot;cofinancier_1&quot;</span>, <span class="st">&quot;cofinancier_2&quot;</span>, <span class="st">&quot;cofinancier_3&quot;</span>, </span>
<span id="cb12-8"><a href="building-the-datasets.html#cb12-8" tabindex="-1"></a>                <span class="st">&quot;cofinancier_4&quot;</span>, <span class="st">&quot;cofinancier_5&quot;</span>, <span class="st">&quot;cofinancier_6&quot;</span>,</span>
<span id="cb12-9"><a href="building-the-datasets.html#cb12-9" tabindex="-1"></a>                <span class="st">&quot;kfw_bin&quot;</span>, <span class="st">&quot;ffem_bin&quot;</span>, <span class="st">&quot;nb_ap_nombre_potentiel&quot;</span>, <span class="st">&quot;detail&quot;</span>,</span>
<span id="cb12-10"><a href="building-the-datasets.html#cb12-10" tabindex="-1"></a>                <span class="st">&quot;iucn_cat&quot;</span>, <span class="st">&quot;iucn_des&quot;</span>, <span class="st">&quot;marine&quot;</span>, <span class="st">&quot;superficie&quot;</span>,</span>
<span id="cb12-11"><a href="building-the-datasets.html#cb12-11" tabindex="-1"></a>                <span class="st">&quot;status&quot;</span>, <span class="st">&quot;status_yr&quot;</span>, <span class="st">&quot;gov_type&quot;</span>,<span class="st">&quot;own_type&quot;</span>, <span class="st">&quot;mang_auth&quot;</span>)</span>
<span id="cb12-12"><a href="building-the-datasets.html#cb12-12" tabindex="-1"></a><span class="co">#Confidential variables in the PAs dataset</span></span>
<span id="cb12-13"><a href="building-the-datasets.html#cb12-13" tabindex="-1"></a>list_var_PA_conf <span class="ot">=</span> list_var_joint_conf <span class="ot">=</span> </span>
<span id="cb12-14"><a href="building-the-datasets.html#cb12-14" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>, <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb12-15"><a href="building-the-datasets.html#cb12-15" tabindex="-1"></a>    <span class="st">&quot;engagements_nets_euro_octroi&quot;</span> , <span class="st">&quot;montant_total_projet&quot;</span>,</span>
<span id="cb12-16"><a href="building-the-datasets.html#cb12-16" tabindex="-1"></a>    <span class="st">&quot;produit&quot;</span>, <span class="st">&quot;libelle_produit&quot;</span>,</span>
<span id="cb12-17"><a href="building-the-datasets.html#cb12-17" tabindex="-1"></a>    <span class="st">&quot;date_de_1er_versement_projet&quot;</span>, <span class="st">&quot;dernier_versement_en_date_projet&quot;</span>,</span>
<span id="cb12-18"><a href="building-the-datasets.html#cb12-18" tabindex="-1"></a>    <span class="st">&quot;date_signature_convention_cf&quot;</span>, <span class="st">&quot;duree_du_concours_annee&quot;</span>,</span>
<span id="cb12-19"><a href="building-the-datasets.html#cb12-19" tabindex="-1"></a>    <span class="st">&quot;duree_du_concours_annee_et_mois&quot;</span>, <span class="st">&quot;beneficiaire_primaire&quot;</span>,</span>
<span id="cb12-20"><a href="building-the-datasets.html#cb12-20" tabindex="-1"></a>    <span class="st">&quot;responsable_equipe_projet&quot;</span>, <span class="st">&quot;directeur_trice_dagence&quot;</span>, <span class="st">&quot;maitrise_ouvrage&quot;</span></span>
<span id="cb12-21"><a href="building-the-datasets.html#cb12-21" tabindex="-1"></a>    )</span>
<span id="cb12-22"><a href="building-the-datasets.html#cb12-22" tabindex="-1"></a><span class="co">#Confidential variables among shapefiles</span></span>
<span id="cb12-23"><a href="building-the-datasets.html#cb12-23" tabindex="-1"></a>list_var_shp_conf <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;mntnt&quot;</span>, <span class="st">&quot;mtglb&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;mnt&quot;</span>, <span class="st">&quot;prodt&quot;</span>, <span class="st">&quot;lbllp&quot;</span>,</span>
<span id="cb12-24"><a href="building-the-datasets.html#cb12-24" tabindex="-1"></a>                      <span class="st">&quot;rspns&quot;</span>, <span class="st">&quot;dr&quot;</span>, <span class="st">&quot;detal&quot;</span>, <span class="st">&quot;projt&quot;</span>, <span class="st">&quot;cmmnt&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="building-the-datasets.html#cb13-1" tabindex="-1"></a>base_nodupl_lea <span class="ot">=</span> </span>
<span id="cb13-2"><a href="building-the-datasets.html#cb13-2" tabindex="-1"></a>  <span class="co">#fread(&quot;data_tidy/base_nodupl_lea.xlsx&quot;)</span></span>
<span id="cb13-3"><a href="building-the-datasets.html#cb13-3" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb13-4"><a href="building-the-datasets.html#cb13-4" tabindex="-1"></a>  <span class="at">FUN =</span> data.table<span class="sc">::</span>fread,</span>
<span id="cb13-5"><a href="building-the-datasets.html#cb13-5" tabindex="-1"></a>  <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>,</span>
<span id="cb13-6"><a href="building-the-datasets.html#cb13-6" tabindex="-1"></a>  <span class="co"># Mettre les options de FUN ici</span></span>
<span id="cb13-7"><a href="building-the-datasets.html#cb13-7" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_DesStat_nodupl_lea_pub.csv&quot;</span>,</span>
<span id="cb13-8"><a href="building-the-datasets.html#cb13-8" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-9"><a href="building-the-datasets.html#cb13-9" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="building-the-datasets.html#cb13-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">names</span>(data_stat_nodupl)))</span>
<span id="cb13-11"><a href="building-the-datasets.html#cb13-11" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="building-the-datasets.html#cb13-12" tabindex="-1"></a><span class="co">#import a dataset with country anmes and corresponding ISO3 code</span></span>
<span id="cb13-13"><a href="building-the-datasets.html#cb13-13" tabindex="-1"></a>data_iso <span class="ot">=</span> data_stat <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="building-the-datasets.html#cb13-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(pays, iso3)) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="building-the-datasets.html#cb13-15" tabindex="-1"></a>  <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="building-the-datasets.html#cb13-16" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb13-17"><a href="building-the-datasets.html#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="building-the-datasets.html#cb13-18" tabindex="-1"></a>base_nodupl_old <span class="ot">=</span> </span>
<span id="cb13-19"><a href="building-the-datasets.html#cb13-19" tabindex="-1"></a>  <span class="co">#fread(&quot;data_tidy/base_nodupl_old.csv&quot;) </span></span>
<span id="cb13-20"><a href="building-the-datasets.html#cb13-20" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb13-21"><a href="building-the-datasets.html#cb13-21" tabindex="-1"></a>  <span class="at">FUN =</span> data.table<span class="sc">::</span>fread,</span>
<span id="cb13-22"><a href="building-the-datasets.html#cb13-22" tabindex="-1"></a>  <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>,</span>
<span id="cb13-23"><a href="building-the-datasets.html#cb13-23" tabindex="-1"></a>  <span class="co"># Mettre les options de FUN ici</span></span>
<span id="cb13-24"><a href="building-the-datasets.html#cb13-24" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_DesStat_nodupl_old_pub.csv&quot;</span>,</span>
<span id="cb13-25"><a href="building-the-datasets.html#cb13-25" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-26"><a href="building-the-datasets.html#cb13-26" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb13-27"><a href="building-the-datasets.html#cb13-27" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">names</span>(data_stat_nodupl))) <span class="sc">%&gt;%</span></span>
<span id="cb13-28"><a href="building-the-datasets.html#cb13-28" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>iso3) <span class="sc">%&gt;%</span></span>
<span id="cb13-29"><a href="building-the-datasets.html#cb13-29" tabindex="-1"></a>  <span class="fu">left_join</span>(data_iso, <span class="at">by =</span> <span class="st">&quot;pays&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-30"><a href="building-the-datasets.html#cb13-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-31"><a href="building-the-datasets.html#cb13-31" tabindex="-1"></a>    pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Mayotte&quot;</span>, <span class="st">&quot;P-N N.Caléd&quot;</span>, <span class="st">&quot;P-S N.Caléd&quot;</span>, </span>
<span id="cb13-32"><a href="building-the-datasets.html#cb13-32" tabindex="-1"></a>                <span class="st">&quot;Polynesie Francaise&quot;</span>, <span class="st">&quot;Nlle Caledonie&quot;</span>) <span class="sc">~</span> <span class="st">&quot;FRA&quot;</span>,</span>
<span id="cb13-33"><a href="building-the-datasets.html#cb13-33" tabindex="-1"></a>    pays <span class="sc">==</span> <span class="st">&quot;Multi-Pays&quot;</span> <span class="sc">~</span> <span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb13-34"><a href="building-the-datasets.html#cb13-34" tabindex="-1"></a>    <span class="sc">!</span>(pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Mayotte&quot;</span>, <span class="st">&quot;P-N N.Caléd&quot;</span>, <span class="st">&quot;P-S N.Caléd&quot;</span>, </span>
<span id="cb13-35"><a href="building-the-datasets.html#cb13-35" tabindex="-1"></a>                <span class="st">&quot;Polynesie Francaise&quot;</span>, <span class="st">&quot;Nlle Caledonie&quot;</span>, <span class="st">&quot;Multi-Pays&quot;</span>)) <span class="sc">~</span> iso3</span>
<span id="cb13-36"><a href="building-the-datasets.html#cb13-36" tabindex="-1"></a>  ))</span>
<span id="cb13-37"><a href="building-the-datasets.html#cb13-37" tabindex="-1"></a></span>
<span id="cb13-38"><a href="building-the-datasets.html#cb13-38" tabindex="-1"></a><span class="co"># projet_nodupl_old = </span></span>
<span id="cb13-39"><a href="building-the-datasets.html#cb13-39" tabindex="-1"></a><span class="co">#   #readxl::read_xlsx(&quot;data_tidy/projet_nodupl_old.xlsx&quot;)</span></span>
<span id="cb13-40"><a href="building-the-datasets.html#cb13-40" tabindex="-1"></a><span class="co">#   aws.s3::s3read_using(</span></span>
<span id="cb13-41"><a href="building-the-datasets.html#cb13-41" tabindex="-1"></a><span class="co">#   FUN = readxl::read_xlsx,</span></span>
<span id="cb13-42"><a href="building-the-datasets.html#cb13-42" tabindex="-1"></a><span class="co">#   # Mettre les options de FUN ici</span></span>
<span id="cb13-43"><a href="building-the-datasets.html#cb13-43" tabindex="-1"></a><span class="co">#   object = &quot;data_tidy/projet_nodupl_old.xlsx&quot;,</span></span>
<span id="cb13-44"><a href="building-the-datasets.html#cb13-44" tabindex="-1"></a><span class="co">#   bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb13-45"><a href="building-the-datasets.html#cb13-45" tabindex="-1"></a><span class="co">#   opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb13-46"><a href="building-the-datasets.html#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="building-the-datasets.html#cb13-47" tabindex="-1"></a>bdd_joint <span class="ot">=</span> </span>
<span id="cb13-48"><a href="building-the-datasets.html#cb13-48" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_joint.xlsx&quot;)</span></span>
<span id="cb13-49"><a href="building-the-datasets.html#cb13-49" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb13-50"><a href="building-the-datasets.html#cb13-50" tabindex="-1"></a>  <span class="at">FUN =</span> data.table<span class="sc">::</span>fread,</span>
<span id="cb13-51"><a href="building-the-datasets.html#cb13-51" tabindex="-1"></a>  <span class="co"># Mettre les options de FUN ici</span></span>
<span id="cb13-52"><a href="building-the-datasets.html#cb13-52" tabindex="-1"></a>  <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>,</span>
<span id="cb13-53"><a href="building-the-datasets.html#cb13-53" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_joint_tidy_pub.csv&quot;</span>,</span>
<span id="cb13-54"><a href="building-the-datasets.html#cb13-54" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-55"><a href="building-the-datasets.html#cb13-55" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-56"><a href="building-the-datasets.html#cb13-56" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">names</span>(data_stat_nodupl)))</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="building-the-datasets.html#cb14-1" tabindex="-1"></a><span class="co">#Test : differences between Léa&#39;s figures and my results</span></span>
<span id="cb14-2"><a href="building-the-datasets.html#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="building-the-datasets.html#cb14-3" tabindex="-1"></a><span class="co">#PA identified with unique WDPAID. If more than 1 WDPAID, take the earlier annee_octroi</span></span>
<span id="cb14-4"><a href="building-the-datasets.html#cb14-4" tabindex="-1"></a>base_id <span class="ot">=</span> data_stat <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="building-the-datasets.html#cb14-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wdpaid)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="building-the-datasets.html#cb14-6" tabindex="-1"></a>  <span class="fu">group_by</span>(wdpaid) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="building-the-datasets.html#cb14-7" tabindex="-1"></a>  <span class="fu">arrange</span>(annee_octroi) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="building-the-datasets.html#cb14-8" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="building-the-datasets.html#cb14-9" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-10"><a href="building-the-datasets.html#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="building-the-datasets.html#cb14-11" tabindex="-1"></a>test <span class="ot">=</span> base_id[<span class="fu">duplicated</span>(base_id<span class="sc">$</span>wdpaid),]</span>
<span id="cb14-12"><a href="building-the-datasets.html#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="building-the-datasets.html#cb14-13" tabindex="-1"></a>base_old_id <span class="ot">=</span> base_nodupl_old <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="building-the-datasets.html#cb14-14" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;NA&quot;</span>, wdpaid) <span class="sc">==</span> <span class="cn">FALSE</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="building-the-datasets.html#cb14-15" tabindex="-1"></a>  <span class="fu">group_by</span>(wdpaid) <span class="sc">%&gt;%</span> </span>
<span id="cb14-16"><a href="building-the-datasets.html#cb14-16" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="building-the-datasets.html#cb14-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wdpaid =</span> <span class="fu">as.numeric</span>(wdpaid)) <span class="sc">%&gt;%</span></span>
<span id="cb14-18"><a href="building-the-datasets.html#cb14-18" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-19"><a href="building-the-datasets.html#cb14-19" tabindex="-1"></a></span>
<span id="cb14-20"><a href="building-the-datasets.html#cb14-20" tabindex="-1"></a><span class="co">#Identify PA in common among them with WDPAID reported</span></span>
<span id="cb14-21"><a href="building-the-datasets.html#cb14-21" tabindex="-1"></a>test_id <span class="ot">=</span> base_old_id <span class="sc">%&gt;%</span></span>
<span id="cb14-22"><a href="building-the-datasets.html#cb14-22" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id_projet, nom_du_projet, nom_ap, id_concours, wdpaid)) <span class="sc">%&gt;%</span></span>
<span id="cb14-23"><a href="building-the-datasets.html#cb14-23" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(base_id, </span>
<span id="cb14-24"><a href="building-the-datasets.html#cb14-24" tabindex="-1"></a>                   <span class="fu">c</span>(id_projet, nom_du_projet, nom_ap, id_concours, wdpaid)),</span>
<span id="cb14-25"><a href="building-the-datasets.html#cb14-25" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;wdpaid&quot;</span>)</span>
<span id="cb14-26"><a href="building-the-datasets.html#cb14-26" tabindex="-1"></a></span>
<span id="cb14-27"><a href="building-the-datasets.html#cb14-27" tabindex="-1"></a><span class="co">#PA whose WDPAID is unknown, identified by id1 uniquely</span></span>
<span id="cb14-28"><a href="building-the-datasets.html#cb14-28" tabindex="-1"></a><span class="co">#The duplicates comes from different concours ID, so do not correspond to different PA</span></span>
<span id="cb14-29"><a href="building-the-datasets.html#cb14-29" tabindex="-1"></a>base_na <span class="ot">=</span> data_stat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(wdpaid)) <span class="sc">%&gt;%</span></span>
<span id="cb14-30"><a href="building-the-datasets.html#cb14-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id1 =</span> <span class="fu">paste</span>(id_projet, iso3, nom_ap, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb14-31"><a href="building-the-datasets.html#cb14-31" tabindex="-1"></a>         <span class="at">.before =</span> id_projet) <span class="sc">%&gt;%</span></span>
<span id="cb14-32"><a href="building-the-datasets.html#cb14-32" tabindex="-1"></a>  <span class="fu">group_by</span>(id1) <span class="sc">%&gt;%</span></span>
<span id="cb14-33"><a href="building-the-datasets.html#cb14-33" tabindex="-1"></a>  <span class="fu">arrange</span>(annee_octroi) <span class="sc">%&gt;%</span></span>
<span id="cb14-34"><a href="building-the-datasets.html#cb14-34" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-35"><a href="building-the-datasets.html#cb14-35" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-36"><a href="building-the-datasets.html#cb14-36" tabindex="-1"></a></span>
<span id="cb14-37"><a href="building-the-datasets.html#cb14-37" tabindex="-1"></a>base_old_na <span class="ot">=</span> base_nodupl_old <span class="sc">%&gt;%</span> </span>
<span id="cb14-38"><a href="building-the-datasets.html#cb14-38" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;NA&quot;</span>, wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-39"><a href="building-the-datasets.html#cb14-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id1 =</span> <span class="fu">paste</span>(id_projet, iso3, nom_ap, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb14-40"><a href="building-the-datasets.html#cb14-40" tabindex="-1"></a>         <span class="at">.before =</span> id_projet) <span class="sc">%&gt;%</span></span>
<span id="cb14-41"><a href="building-the-datasets.html#cb14-41" tabindex="-1"></a>  <span class="fu">group_by</span>(id1) <span class="sc">%&gt;%</span></span>
<span id="cb14-42"><a href="building-the-datasets.html#cb14-42" tabindex="-1"></a>  <span class="fu">arrange</span>(annee_octroi) <span class="sc">%&gt;%</span></span>
<span id="cb14-43"><a href="building-the-datasets.html#cb14-43" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-44"><a href="building-the-datasets.html#cb14-44" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-45"><a href="building-the-datasets.html#cb14-45" tabindex="-1"></a></span>
<span id="cb14-46"><a href="building-the-datasets.html#cb14-46" tabindex="-1"></a>test_na <span class="ot">=</span> base_na <span class="sc">%&gt;%</span></span>
<span id="cb14-47"><a href="building-the-datasets.html#cb14-47" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id1, id_projet, nom_du_projet, nom_ap, id_concours)) <span class="sc">%&gt;%</span></span>
<span id="cb14-48"><a href="building-the-datasets.html#cb14-48" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(base_old_na, </span>
<span id="cb14-49"><a href="building-the-datasets.html#cb14-49" tabindex="-1"></a>                   <span class="fu">c</span>(id1, id_projet, nom_du_projet, nom_ap, id_concours)),</span>
<span id="cb14-50"><a href="building-the-datasets.html#cb14-50" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;id1&quot;</span>)</span>
<span id="cb14-51"><a href="building-the-datasets.html#cb14-51" tabindex="-1"></a></span>
<span id="cb14-52"><a href="building-the-datasets.html#cb14-52" tabindex="-1"></a><span class="fu">nrow</span>(test_na <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="fu">is.na</span>(id_projet.y) <span class="sc">==</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-53"><a href="building-the-datasets.html#cb14-53" tabindex="-1"></a></span>
<span id="cb14-54"><a href="building-the-datasets.html#cb14-54" tabindex="-1"></a><span class="co">#base_nodupl</span></span>
<span id="cb14-55"><a href="building-the-datasets.html#cb14-55" tabindex="-1"></a></span>
<span id="cb14-56"><a href="building-the-datasets.html#cb14-56" tabindex="-1"></a>base_nodupl <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">select</span>(base_na, <span class="sc">-</span>id1), base_id)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="descriptive-statistics-on-biodiversity-in-the-protected-areas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/00_data_build.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
